There we go. I think that's recording. Hi, everyone. Good morning. Welcome to another healthy live demo and clinic. Today, we're going to be talking about dags and using a package called ggdag, which works quite nicely. There is, for making dags in general, a really useful web application called dagitty which you can also code within R. But today, we're going to be talking about ggdag because it follows quite nicely with the kind of ggplot, tidyverse type coding style. Today we're going to have Neil who's sharing his screen and he's going to be doing the live coding for us. Neil, if you could open the document Dag underscored demo up at the top, it's a quarto document, a few more up yet that one there. There we go. That's perfect. Now for anyone who is new to R, we've just got our posit setup, which is a cloud based version of our studio, which has our four screens that we like our top left, is our script. We're using a quart document, which is where we're going to be typing our code. Bottom left is the console, top right is in the environment, where data will get stored, any kind of functions we make, those sorts of things and then our bottom right is what we can do a bunch of things, but it's where our files. We can do our files, and also where we'll get our help tab and thing. We're going to be focusing on the top left panel, which is our quarto document, which is similar to our Markdown, for anyone that used it before. But yes. We're going to be talking about dags. So in the top chunk, there should be Can you toggle between source and visual quickly because I feel like it's not showing the package. Yeah, there we are. The two packages that we're going to be using today is ggdag and also briefly the tidyverse. So that's why we've installed. That's why we're calling library ggdag and tidy verse there. We have those packages ready. So if you could just run that chunk for me, Neil. That's perfect. And so I'm just going to start by taking you through how you make a basic dag using GG dag. So we start off by using this function called dagify, which is basically what is used to make your dag. And then it follows the syntax of specifying your outcome, and then you do a little tilde sign to your exposure. And that is basically going to create a dag that has the thing you're pointing at. And then the thing that's doing the pointing is in that kind of setup. If you run that chunk and then we put it into ggdag, which is what creates the dag. If you run this chunk and then we'll see what it creates. Oh. There. So you can see that it's created a really, really basic dag, but ultimately that's what a dag is. It's trying to identify a causal pathway between an exposure and outcome. It can be thought of as a bit like a brain experiment of what you think your causal pathway will look like. It's good to do this before you kind jump into any kind of analysis so that you can identify factors that you think will be important in your in your experiment. It's good to think about these kind of things with domain experts as well so that you can kind of get a really full picture. But yeah, that's a bit too much theory behind dags. Let's talk about ggdag a bit more. Sarah can I ask one quick question about that. Yes. I noticed that this doesn't need. So it knows to treat this as a text, which is the label for the node of the dag. Yes. So this isn't linked to any kind of data right now. So it's just those bits there are you specify and it knows that you're talking about these kind of y, the nodes and the text on top of the nodes is what you put. So it's important to note that you can't have bases in those names. Right now, it has to be no spaces. So if you wanted to do a longer word, you'd have to do things like underscore underneath it, but later on I will show how you can add a label so that it can be more of like a easily readable human readable type label as opposed to just your no space label that you'd have to have here. So one thing to note is, if you run that again, that chunk there, It's different. Every time. That's because of the randomness. We could overcome that by using set seed so that every time that R generates this plot, it uses the same random numbers that it's using to generate that. But later on, I'm going to show you how you can actually just manually set the coordinates, which is sometimes a little bit more useful when you're doing something like a dag because sometimes the It can get quite messy quite easily, so it's good to put things where you want them to put them. But it's just to note that every time you run that, it'll be different unless you set the seed or set the coordinates. Okay, so that was just a bit about the syntax of how to use ggdag. But now I'm going to put it into a bit more of a health care context because a lot of us might be doing kind of research in kind of health care sector. So I'm going to be pitching to you that we're going to be do we want to look at the causal pathway between something like social media use and a poor mental health outcome. So that's our experiment that we're going to be doing. So could you copy the code from above and then change outcome and exposure to just a term like social media use and for mental health outcomes. Remembering that these are just short labels. We can't use spaces and things. Yeah, that looks good. Yeah. Perfect. If you run that, see what it looks like. Great. Now you can see exposure and outcome have been replaced with social media and mental health. Here we're saying, we think with increased social media or we might hypothesise that with increased social media use, this can cause poor mental health. And But we know that this isn't going to be the only thing on that pathway. There's lots of other variables, be that confounders and mediators that we're going to want to take into account and that we're going to want to have on our dag so that we can put that in our study, and we can say, look at all these things that we're actually going to be taking into account. So to do that, what you need to do is So following the syntax of the thing that's getting pointed at to the things that are doing the pointing. You can similar to using glm in R, you can use the plus sign and add on in that formula syntax, all of the other things that are going to be pointing at the exposure. Yeah, except no space. Yeah. And then if you want to be having things pointing other things, you would do a comma and then go on the line below and then do that again. Yes, exactly. More things. So if you scroll down slightly, I've created a space, and I'm going to pitch to you that I think we should add. This is something that could be up for debate. There's lots of different confounders and mediators and colliders, et cetera that you might want to take into account in your dag. But to keep it relatively simple for this demonstration, what I'm going to get you to add is, I think age Is an important confounder, and also personality type is an important compounder. And these are things that maybe you want to measure for a dataset if you're about to go out and actively collect, or maybe you have a dataset and you already have these variables. So these are the things that I want you to add as a cono, a compounder being something that impacts both the exposure and outcome. And then I also want you to add sleep duration, except I am thinking that this as opposed to a confounder, might be a mediator in that I think Increased social media use could lead to shorter sleep duration and shorter sleep duration can ultimately lead to poorer mental health. So we would want the arrows to be pointing differently to a confounder. So after this, I have mental health is the sort of outcome. And on this side, I want to put all the things that are pointing to that outcome. Yes, so we want to have social media, age, personality and sleep or sleep, whatever we would call it. Then we want to do a comma and go in the line below because we also want to have sleep duration that points at that's being pointed at by social media use Is a confounder is I'm trying I'm trying to imagine what this is going to look like. Okay? Yes. That is one thing about using ggdag. Sometimes it's nice to maybe have it drawn out in paper or maybe even dagitty, which is the online web app I was talking about at the start. And So right now we're going to have social media use, age, personality, and sleep duration pointing at mental health. But we also want to have social media pointing at sleep duration to make it that mediator pathway. But what we also need now is age and personality to point at social media use because we think they're confounders, and they'll be pointing at both the mental health and social media. Exactly. Like that. Yeah. Let's run it and give it a go. Yes, so a bit of a funny shape, but this is what we want. If you can see that you've got social media use, pointing at mental health. We've got personality and age, pointing at both as confounders, and then we've got that mediating pathway of social media, pointing at sleep duration. Increase social media use, causing sleep, sleep, causing poor mental health outcomes. This is the dag that we've put in, the bag that we're looking for, maybe not quite the layout of the dag. It's a bit tricky to see. If you scroll down again, what we're going to do now is we're going to set the coordinates. If you copy that chunk and paste it in here. So if you hit F one on again you'll see all the things that we put into it. And if you scroll down slightly, you'll be able to see an example of setting coordinates, there. You can manually set your coordinates there. So you would set a list of the coordinates, and then you would within dagify add that coord or label. So if we copy over the coords list and then we can manually change it to how we want it to be. I do it inside the same chunks, like this? Yeah, you can do. Yes. This is basically setting the x and y coordinates. Exactly, you want to change the x and y coordinates for each of our variables. Then we can have a think about where we want them to be. Okay. This is just like a relative coordinate. We might want. You can make up wherever you want it to be. But for example, you might want social media used to sit at 0,1 on the y axis one. Then you would want mental health to maybe be 10,1 or two or 5,1. Then you might want age to be kind of above. So if you do that and set it or something on that yeah, exactly. Personality, similarly somewhere like three and maybe If I put minus one, that'll go below exposed. I'll just change the axis on the y axis and make it lower. The confounders above and the mediator below like that. That's a good idea. But you can really customise whatever way you want it to look. But, just add coords equals. And then run that whole chunk and see what it looks like, brilliant. That looks much easier to read, I think, and it's basically just gone exactly where you specified on the x and y. One cool thing that I learned while doing a bit of research before this topic is I think it's quite useful to specify exactly where you want it to go. But if you start getting a really complicated dag, the important thing to remember about dags is It's time sensitive in that your exposure always has to come before your outcome just for that causality to happen. So there's always a time order to your dag. So instead of manually setting the coords, you can also use a function called time_ordered_coords So if you try putting that in there, where you've got coords equal, just to show people what it looks like. Instead of coords if you take it away and time underscore, and then there is ordered coords. So if you hit that, and then just run this chunk of code now. Instead of manually setting, it's basically just It's taken into account when if you have an arrow pointing at something, it has to come first as such. So it's given a time ordered to it, which I think can be quite helpful if you've got lots of different variables. It can neatly order it for you quite quickly. But manually setting is a simpler way to get things exactly where you want them to be. Right. So now we have our positions for our nodes. If you copy and paste that chunk and then maybe turn it back into the coordinates that you set, we'll customise a bit further. Okay. Brilliant. So what we can do now is so you'll see if you scroll up in the help tab that we have slightly. You'll see that we can set exposure and outcome. So that's what we're going to do now so that we can tell our dag which one is our exposure and which one is our outcome? Because right now, it's all just see of the same. So within dagify again, if you add exposure and outcome, So our exposure is the social media use. I think it has to be quoted this time, though. Brilliant. Then if you run that, nothing has changed because we have not told ggdag to really it now knows what the exposure and the outcome is, but we've not asked it to plot it in a different way. For that, you would want to use the function ggdag_status() instead of ggdag() If you add that in there. Sorry Sarah. I missed that. What was it called? ggdag_status() There. So now you can see it's coloured the exposure and the outcome for us. The next thing I don't really like about this dag is that we can't have any spaces in our labels. Also, the labels are too big for the nodes. So it's a bit hard to read. You can't really see social media use at all and things like that. What we're going to do is we're going to set our labels within dagify again in the help tab you'll see that there's the labels there that we can set. We're going to do that. This, we're just going to use the combined function and basically then set the name that we've given our node and then equals, and then we're going to quote exactly what we want it to be instead. We can use spaces in whatever we want within the label. So. Yeah, that was good. And then, yep, we'll do that for the rest of them. So social media use. Perfect. Now within the GG Dag status function, we have to say, gosh, I think it's labels equals, gosh, I try running that. No, I didn't work. Labels equal label. That didn't work either. Try going on the help tab of ggdag status Okay, so it's use underscore labels, sorry. No, I just labels. Use labels equals true. I think it's labels equal and I think it's text in quotes. Okay. Right. Try use labels and encodes labels. Fifth times the charm. Label. There we go. That's it. That's just given us a little label on top of each. Now if we say text equals false, it'll get rid of the text on top of the node. There we are. That's looking a little bit neater, no. Scroll down, see what the next. Yes. If you copy and paste down that chunk of code into that empty chunk. X and Y axis, we've set in order to give the positions of our nodes. But we don't actually need to see the X and Y axis on our plot because they don't mean anything. So if you add theme underscore Dag, not as a not within ggdag status, but if you add, do a plus sign, not a pipe, a plus sign like ggplot Yeah, there we are. And then do theme underscore Dag and then run that. It just gets rid of the gets rid of the background, and it just gives us a blank slate, which I think probably looks better, easier to read, and the coordinates didn't really mean anything anyway, so it was nice to get rid of those themed dag is just like gives you kind of like out of the box dag settings from the package ggdag, which I think looks quite good. So there we have a dag. We can see our causal pathway that we're trying to investigate is social media use towards mental health. We've got our confounders at the top, which are impacting both social media use and mental health, and we've got our sleep duration as a mediator at the bottom. But now I'm just going to talk through some of the extra functionality that ggdag as a package has just to help you prepare for your analysis or building any models afterwards. Now that you've got your shiny fancy dag. So yeah, if you copy and paste that into the chunk below, Neil. if you get rid of the ggdag status and the dag and just leave us with. This is our dag that's not been plotted currently. And if you instead pipe that into gg underscore open paths, or maybe its just gg_paths(), actually, sorry, not open paths. And then run that. Yeah. So now, ggdag has identified the four open paths that we have between our exposure and our outcome. So it helps identify the things that you might have to take into account if you're trying to assess the true impact that social media use has on mental health because right now, we can see that there is an impact that age and personality and sleep duration will have. In order to identify the adjustment set that you might want to use in your model, ggdag also has a function called handle name ggdag_adjustment_set, I think. So if you want to use that one, give that one to go, we'll see what it shows us. Yeah, there. And so this is basically showing us that in order for us to assess the impact that social media use has on mental health, we're going to have to adjust for personality and age. And that's our minimum adjustment set that we're going to have to do. It's telling us not to adjust for sleep, and that is correct because we've suggested that we think sleep is a mediator. We think that social media use impacts sleep, which impacts mental health. And that mediating pathway, if we adjust for sleep duration, it will impact the suggested impact that social media use has on mental health. And we want to be able to get that kind of, like, true estimate, I guess, so you wouldn't adjust for a mediator in this case. Yeah. I think that's a pretty neat feature of ggdag. It can be quite helpful, particularly if you have a more of a complex dag, it can help identify the variables that you need to adjust for. If you have a pathway that has multiple variables in it to block that pathway, you wouldn't necessarily have to adjust for everything in it. So this can be a useful function for identifying what needs to be adjusted for and what doesn't in order for you to estimate that causal pathway. Yeah. So those were kind of the most useful features that I found within ggdag. No worries Rose. Thank you for coming. There is a bit of kind of like additional customizations that I've planned for, but time is running on a bit. So if anyone has any clinic questions, it might be worth stopping that here and jumping into that instead So I'll pause the recording now, and then we can have a chat about that. And then we can maybe come back to this if we need to. But yeah, that's ggdag, everybody. I hope you enjoyed that.