There we go. We're recording now. Hi everyone. Welcome to the First Healthy, R clinic of 2024. Hope everyone had a really nice festive season and is looking forward to the New Year. Today we're going to be doing our demo on venn diagrams, which is a requested demo. If anyone ever has any requests of topics they'd like us to cover, I like to try and tailor the clinics to things that people actually find useful and helpful and might help their day to day life. We really appreciate requests. Today you've got Neil with me who is sharing his screen. This is just IDE or R studio interface on Posit Cloud link is in the chat, it just shows us right now it's the three panels. But if you open up the R markdown document that's called one underscore venn yes that one there we'll see the four panels that we're used to seeing. The top left is the bottom left is the console top right, our environment where our import imported datasets will end up. And then the bottom right is where all our scripts and files are saved. A few other tabs that do different things, but they are less important Right now, Neil has opened up the R markdown document, which is a place where we can type our code and also free text. It's made up of a few things. It's got the yaml at the very top, where is where you set a bunch of metadata. Things like the title of the document, the author, the date, and lots of other different customisable options. Then we've got this grayed out section which is code chunk. It's in the grade sections that we type our R code. And then in the white sections where we can write free text. Don't scroll right to the bottom of the document because I have some answers just in case we want to have a check of those. But can you make the script quadrant a bit bigger and then maybe zoom in slightly to make the text slightly bigger? Hey, is it okay? Yeah, that looks good If you scroll down, if you just run the data prep chunk that I've made which has the packages that we're going to use, then just a few little bits. Tidy verse is a package that we frequently use, really good for data data wrangling. You can see there all the packages that it loads in table Tidlist, cetera, M. Then there was a GG Ven package that we're going to be using for making our ven diagrams today. Janitor is just one that I've used for this clean names function, which is just a quick way to remove special characters and spaces from your column headings to make it a bit cleaner, Upset R is something that we're going to demonstrate at the end when venn diagrams get a bit complicated. Excellent. Neil, could you start off, we've got a fresh dataset. Don't know much about it. Would you be able to open up the dataset, have a look at it, and then maybe try doing a few counts on obesity, smoking, diabetes. I should say quickly, this is a dataset found online from the tidy Tuesday database, which is just made it a really cool location to get lots of online datasets to practise your coding skills. This is just looking at like a heart health database kind of thing. And I've just filtered for 5,000 observations. So yeah, sorry, rambling. Now over to you if you can. So what I always like to do is just click on the dataset and just have, have a look at the visual just to get a feel for what's there. So I can see we've got 26 columns here, 5,000 rows. We've got patient ID, some demographic information, cholesterol measures of blood pressure, heartbreak. Family, history, smoking. Okay. All kinds of information. Stress level. Is that like a self assessed? General life stress measure. Good question. I'm not sure. Yeah, I guess it's maybe self assessed. I didn't quite learn about how the variables were made. I wonder what it means. Okay, Someone's getting nine out 10 hours sleep a day. Look at them, what's their stress level? Stress level seven. Okay. All right. Right. Okay. So we've got all kinds of information on it. Looks like 5,000 individuals. Yeah. And the reason some of them are true and false is because I earlier in the script changed it to true and false as opposed to a binary one or zero. Because that just makes it much easier for using the GG package. But it's showing the same kind of binary. Yes. No content. So we've got different countries here, so we could say, we could do sort, sort that. Okay. So it's quite evenly distributed across different countries. So there's 200 and odd from each country. What else might be interested in? I'm going to go to that stress level variable. I want to see. I'm not sure that it's quite evenly distributed over stress levels as well. Yeah, what kind of questions are we going to be asking about this data for this example? These are all people that are, it's information on their heart. These are all people are potentially at risk of having a heart attack. What we're going to be looking at, what we're going to be looking at with the Venn diagrams is plotting the co morbidities or other symptoms that these people are experiencing. For example, we're going to be looking at whether or not they're smokers, alcohol intake, et cetera. Just to have a visualisation of the co morbidities that these people that all have a history of heart disease have. Should I make a plot, Sarah? Yeah, I think plotting your data before you try and jump into anything complicated is always really important. So maybe if you try doing a bar plot, if you do heart attack risk on the x axis and then fill the colour based on diabetes and then just have a check and then do a geom_bar and have a look at that risk. Is that right, fill, fill What it was called diabetes or just any of the comorbidity variables. Perfect. There we are. Now we've got a really quick plot though. It's zoom out slightly. It's showing us the counts of heart attack risk is currently viewed as a numeric variable, which is why that is giving us a continuous scale as opposed to just one or zero. Could you change that quickly? Just make it a factor? So am I allowed to do that? Just in here at Yeah, you can. I what Neil is doing is changing the x variable to a factor as opposed to changing it in the entire dataset because we're just caring about it. In this quick instance, you can just put it into the aesthetics bracket there. When you scroll down, you'll see that it's changed x axis, it's Fct, but you can see that it's now 1.0 as opposed to a continuous scale, which wasn't correct because even though it's 1.0 we know that that's a two level factor, not a number. As now you can see that there's over 3,000 people that are not at risk of a heart attack, under 2000 people that are at risk. And you can just see how the spread of those patients that have diabetes split between those two patients. Yeah, just like you're saying, counts and plots are really important thing to do at the very beginning just so that you can get to grips with your data, you can see if there's any abnormalities, anything that you don't expect, et cetera. Now for the sake of time, we will jump into the actual Venn diagram part of creating this diagram, the bend diagram part of the diagram demo. I hadn't made many Ben diagrams in R before this request came in. Did a bit of research and there are lots of ways to do it. There's a package called venndiagram, which is quite popular to use, but I found it quite complicated and clunky and you add to input a lot of the numbers manually. Instead, we're going to be using this function, ggvenn, which is from the ggvenn package. Which flows much more nicely into a tidy verse work flow. But just to let you know that there's other options out there. What we're going to start with now, Neil, is as always going to start with our dataset and pipe into the function ggvenn. Yes. At its basic, all you really need to do is specify the columns that you want to be included in this V diagram. If you do columns equals and then do a combined like a C, open brackets for this one we're going to do, you can do whatever variables you're looking at but why don't we do diabetes and smoking and just to see how those two variables overlap and then run that. The variables have to be in quotations for this yes object just like that. It's done all the counting up for us. It has to be in a logical format which was why they were all true and false before. But that's just a really quick and easy way to get a really simple venn diagram. You can see it's got the overlap and the two numbers at the side. When you say to be a logical format, does that mean that these variables, diabetes, these have to be true false smoking To be true false, it can't be 10 anything. Yeah, it can't be 10, even if it's viewed as a factor. Logical format is what you need to change it to. But that's really simple. If you scroll up slightly, can I did it for us at the very beginning here? Slightly as logic, it's really quick and easy thing to do, just as you would change things to a factor or a number. You can also change it to a logical output there. But yes, if you scroll down again to the diagram, this was a really quick and easy way to do it. But what I don't like about it is that the circles are equal. Sizes might be a bit misleading. It looks like the smokers and those that have diabetes is quite easy. It doesn't look like there's much overlap. There's actually a handy function in this ggvenn package, not function, argument called auto underscore scale. If you set auto underscore scale to true, that should help us out a bit. There we go. Now it's changed slightly. It seems a lot more realistic or visually at a glance, you can see that the smokers encapsulates almost everyone that is also diabetic. I just think that's a bit easier to see the output as opposed to the two even circles that we had before. You can change lots of other things. If you put F one on the ggvenn function, we can have a look at some of the options, but you can change the colours and the size of the font and all of those things. We're just opening up the help document at the moment. Just now, just to have a look at all the things that we can change in this venn diagram. These are all default, it's autoscale is false. That's because the autoscaling is only possible in these simple venn diagrams with two variables. When it comes to more complicated venn diagrams, the mathematical applicability of having the correct overlap of exact circles, which is what we're plotting here, gets too complicated. You can't actually scale those. I think that's why by default it is false. Why don't we have to go at changing fill underscore colour. Right now it's using the blue and yellow. But why don't we change them to any colour? We only need to give it two. We dont need to give it three colours because there are three cos on the plot. You need to give it two and the middle colour, because it's slightly transparent, like the alpha of 0.5 I think it's just overlapping those colours. Brilliant. Now we've changed the colours to purple and green. You can change them to, the opportunities are pretty vast colour. You can give colour names or hex codes. Try changing fill Underscore alpha just so we can have a look at how the transparency works. That middle overlap intersection is just made up of a mix of both of those colours. But I think that's because of the transparency. If we make it 10 by default 0.51 it'll be opaque. Yes. Yeah, that doesn't do the overlap colour as much, which I think the 0.5 default is probably a good shots on. The green has dominated, taken president, if it's zero with the puck. All right, so colour at all. So this is the overall. Transparency of it. It's not just the centre. I guess that means the brain one is being put over the purple one. Which is why when they were fully colour blocked, the green one was on top. Makes sense. Okay. Yes. That's just a bit of a demonstration that you can change most things here. You can change the text size, you can change the colours, you can change, you can change almost anything that you don't like about this. And all you have to do is add the argument into your code junk. Okay, let's try three variables, okay? Yeah, we've already pretty much done that task there. Skip that? No, no, it's all right. I was just trying to formulate things in my brain a bit more. If you copy the code chunk from task two into task four, and then we can add a third variable. So that's the columns she had like obesity I think is the name of the other column. There we go. Just try running that, right? Yes. This is what I was trying to mention earlier that you can't scale more than two. The two venn diagram looks quite nice because you can scale it. The circles are proportional to the sample, vaguely proportional to the sample size. But once you start doing more than two, it gets quite tricky. We're going to have to take out that autoscale argument. We can't have autoscale equals true. This is the same with the other functions or the other packages that I was looking at in how to make venn diagrams. The venn diagram package also can't scale on three or more usually. What is this error? Insufficient amount. Okay. This is an error that's come up. It's quite nice to see errors. It's basically telling us that three is needed, but only two is provided in the manual scale. This is in reference to the colours. We've given it two colours, but now there's going to be three circles. We just have to give it an extra colour. Perfect. There we go. Now we've got a Venn diagram of our three comorbidities and you can see the overlap between the intersection between diabetes and smoking. Smoking, obesity, obesity, and diabetes, and then also the intersection of all three in the middle there. It's a bit trickier because you can't scale the circles to different sizes. The overlap doesn't necessarily match the size of the number that it's giving you, which I find a bit frustrating. But when you're using two variables, it can be a nice way to demonstrate three. As long as you have the numbers there, it's not too complicated to understand. It starts getting really hard with four variables, which we can show just for fun if you add a fourth variable into the column. If you add alcohol consumption, alcohol underscore consumption. And then you'll need to add a fourth colour as well. Any more colours. Oh yeah, it gets a bit crazy. I don't find this diagram that useful any more. Yes. Venn diagrams. I think with two, you can make some really nice ones in R. After that, they get a bit tricky. But now I'm going to slightly pivot the request to what I would do if I was trying to visualise this data in R. What I would do instead was create an upset plot. What does the numbers that far out that basically the question is what does the number represent? Lost the chat. What does the number represent that appears outside the diagram each time? That is the patients that don't fall into these categories, although they should just be right. Yeah, they're the ones that are a false for everything. 30 patients are not obese or smokers, or diabetic or consume alcohol. Yeah, it's a bit funny. Theoretically here we might want a circle. Around the outside of these are people that have heart disease thing. And then those 30 people would fall into that circle, but they don't have any of the comorbidities depending on what you're actually trying to visualise, right? So this is not a particularly useful diagram. It could be, Yeah, I find, I think upset plots would be where I would jump to if I was doing above three or maybe even above two variables, depending on the type of journal or publication or manuscript you're trying to write. If you scroll down nesse lines of code I've just written in advance, I'm just creating a new data frame called Upset data from our heart underscore DF data frame. I'm selecting the variables I'm interested in. I'm interested in the column diabetes, obesity, smoking, alcohol consumption, and medication use. You can imagine these five variables in a Venn diagram. There would be a lot of overlap. It'd be very difficult to work out what number is representing, but you might want to have a diagram that shows the patient. You might want to know if there's patients that have lots of these combilities or if we're looking at a dataset of people that tend to just have one. Yeah, there's just lots of reasons why you might want to have a venn diagram style diagram type information in a different diagram. One important thing to note is that to use the upset plot, you have to use this function as.data.frame, which turns it into a data frame as opposed to a tibble, which we use commonly. In the tidyverse, I think this is because upset, the package that's coming from is from five years ago, which in Rs lifetime is quite old, I guess. It doesn't handle tibbles. That's just something to Oh yeah, just there we can show you without as a tibble. And you can see the error if that is helpful. But it's just important to note that sometimes older packages don't like tibbles, which is a bit frustrating. But yes, if you run that chunk, the create the upset data. Just the first part. Both parts. Both lines we can do all. We can talk through what the second bit is doing as well. Okay, there we go. If you open upset data quickly, just to have a look at so everyone can see what it looks like. These are the columns that we selected for. Instead of true and false, it's going back to ones and zeros. I did that in advance just because it's a bit easier. Upset needs ones and zeros as opposed to trues and false. That venn diagram needed, that's what that was doing. You'll notice the column headings are now back to having capitals and spaces in them. I'll explain why I did that. We create an upset plot. It's mostly just an aesthetic thing. If you go back into the markdown document, Neil, and create a new chunk and we're we're going to make an upset plot. What you want to do is you're using the function upset, it's just upset that would be upset is the name of the function that we're using from the library upset? Yeah, that's that, as you can see in this helpful tab, the things that it needs, all you really need to give it is the dataset that we want. If we start by doing that upset data, we can change some of the aesthetics there. If you run that, just see what it makes. There we go. Can you use out slightly so we can see it all at once? This is what an upset plot looks like. I like to do order by frequency because right now it jumps around a lot. It might actually be easier if we add it in the frequency order before we talk through what it's showing. Yes, it's just order by then, freq, in perfect. And that just creates, it's a bit easier to see because the numbers are in descending order. Now, basically this is an alternative to a Venn diagram. The bars in the top plot are counts of how many individuals have the combination described using the lollipop things. At the bottom, you'll see that 440 people have obesity, consume alcohol or diabetic and smoke. Then 434 take medication for their heart, consume alcohol, diabetic and smoke and so on This diagram, you can see that most of our patients have multimorbidity. If you can call these co morbidities, few patients have only one or two combinations. The reason I changed the names of the columns early on is that the bottom half of the diagram, you can see that it's nicely formulated headings as opposed to the column headings that would have had no spaces and underscores. Cool. I guess if you go in the help tab for the upset plot, we can have a look at some of the things that we can customise with this number of sets. I guess that's if you have lots of, we only have five anyway. But if you had more, there might be some outliers that are less informative. So you might want to just reduce that number, number of intersects. I think, yeah, that could be, again, there might be some outliers at the other end. Is that 40 that we have that like 40. Anyway, you can change the number of intersects that you're interested in with that order by frequency is the main one that I do every time I make one of these. Because I think it's a bit more informative to be able to see that trend as opposed to it being a bit more up and down. Why don't we We could change the minbar label from intersection size. We could change it to whatever we want, something like number of patients or Yeah, try number of patients. Okay, so label going to call it number of patients. Let's change this. Yeah, so let's change that there so we can, yeah, it doesn't have to be intersection size, which is the default. You can change it to whatever you want it to be. Let's do one more and change the colour of the main bars. Let's do bar colour and change it to whatever colour we want. When it comes to changing all colours as a whole, it's more of an aesthetic thing as opposed to trying to convey information. But it's sometimes nice to have like a theme of colours that you use a lot. Yeah, light blue is nice. Now, those bars are blue. Awesome. Yeah. As you can see in the Help tab, there's loads and those are things that you can do to change the point size, line size, the numbers that you see, the colours. Yeah, I find upset plots quite useful if you're trying to convey diagram like information. But you've got too many variables but it gets a bit too complicated. Yeah. Is it possible, the question, is it possible to have each colnability in its own colour? Good question. Let's see if we can work that out. If we have a look at this is what I would do or what we would do when we're not sure. I've never done that. I would have a look at these options. I think it's set bar colour. These are the sets. If we try changing sets bar colours, but create like a combined and give them five different colours, see what happens, and then we'll do fine calls, give it a go. I'm not sure if this will work. Yeah. Okay. That's the bars. Okay. That's those bars. What other colours can we sit if you find in topic? If you search the word colour? Sometimes I just like in that one other search box next to the, although I think you'll have to spell it the American way. See what comes up? A tribute colour? It might be. Yeah. Oh, colour of the intersection points is that. Yeah, I think it's that. Give that one it goes matrix colour. Wanted. So I'll just copy this. Yeah, just use the same colours. That is not what we wanted. Oh, so that's just looking for one colour. Okay. Right, that's annoying. It's just taking the first colour which is orange and made them all. I think that would be would it be the main bar plot if you tried putting the combined colour list in there? Is that what the question was about the currently blue bars bar colour? If I put this? I don't know. Yeah, we can try it. Yeah, I think that that's for the main bars that are going up and down. I think, yeah, that technically or whatever number it is. I think ideally each comorbidity where the coloured bars on the left hand side are, each of the dots would also have that colour, just to make it easier to read. But I don't think it's going to take that. It's taken orange as the first colour we've given it and just coloured them all that way. It looks like the answer is no. A colour coming to go and change all the colours. A colour colour of attribute histogram bins or scetoblock points. Okay. Yeah, actually that sounds like it could be. Try taking out the matrix colour one. And Agnes, do you mean the ones that are currently light blue? That you would like to have them different colours? Yes. Yeah, I would have wanted to see that killed in different colours depending on the number of commodities. But it seems like there can only be one colour, so That's okay. Yeah. Yeah, I'm not sure if you can change that one. We'd have to give it a colour for each, 567-89-1062 31 colours to make it to manually set it, unless we can give a palette. I think I, yes, I'm not quite sure, but I can have a search. And then before I upload the code to this demo, I can see if I can fix it and then add that in. But otherwise, does anyone have any questions on this content or indeed any quick clinic questions because that ran on a bit. Yes. I will share a link to the previous videos on Github. I'll do that right now. Right. I'm going to stop the recording and then we can get any brief questions if anyone has any. And I'll share that link just now.