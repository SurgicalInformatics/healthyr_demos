Hello and welcome to another healthyr live demo. Today's demo is on factors, how to read them in, handle them, recode them, collapse them. I'll also tell you what they are. Can you please run those lines and read in the example dataset. This is the same dataset we used last time. It is the licorice, abbreviated it to licodata but it is licorice. This is an RCT that to see whether giving patients who are about to undergo surgery and therefore intubation for anaesthetic, Whether giving them a licorice gargle as compared with a placebo sugar gargle reduces post operative sore throat which is caused by the intubation tube. If you click on the data set please, you can see that the data set other than the age and BMI, which are numeric values, other than that, most of it are 1s and 2s whereas we would expect them to be yes, no for  Sugar Licorace. It's very common for obviously datasets to arrive in these categories rather than the actual values. If we were looking at if, for example the first column agenda. If that said male and female, it would be a, we call it a character column because it's a zero, It's a numeric column. Whereas really it should be a character or a factor. I'll just show you how to re this. Can you make the environment slightly bigger then? If you click on a blue arrow, you could see that R thinks that gender is numeric and say smoking is numeric, which it is. But obviously we will change it into a factor. Let's go back to the data script please. We'll have to find a data dictionary that will tell us what the zero numbers mean. If you could open up, move your cursor to where it says medical data licorice gargle Move your cursor there and then click one by function F one on your computer. It should hopefully bring up the help tab because I grabbed the dataset from an R package. But obviously if you're loading in your own dataset, you will get the code book from whoever provided the data. If you scroll down just a little bit, let's look at what are the values levels within the gender. Okay, We can see that zero stands for male and one stands for female. Let's get that changed in our dataset. On a new line, please type in licodata into a mutate because we always use mutate to either add a column or a mutate column the name of a new variable and call it preop gender. Yeah, like that. Pre op gender. Call it the same name as before. Yeah, but yeah. Give it two. Okay. Yeah. Now that equals pre op gender variable, add number two as well because we don't want to overwrite it immediately. Yeah, yeah, perfect. The second pre op gender is piped into the factor function which takes a number and makes it into character characters and factors look very similar. But I'll show you what the differences once we have actually created a factor factor exactly brackets. And if you just run that, just make sure that it works. Can you make the console slightly bigger? It's added it to the end. Okay. Okay, I've got a better idea. Put the console away, save Licodata all into something called Licodata. Cool. Yeah, if you note on that it will show up in the environment instead of being printed. So if you look at it got added to the very end like that, it still looks very much the same. But if you were to open up the little blue arrow and scroll to the bottom there, you can see that we now have a factor with two levels. And the levels, all the levels are still 0, 1. We will, I'll now show you how to change them into male, female. Go back to the yeah, the script please. To change factor. Pipe the factor function. Piping pipe the factor function into factor recode (fct_recode). Whenever I do this, well, I sometimes type it in because I've done it so many times. But I would recommend copying it from the healthyr book or this clinic because there's quite a lot of brackets and pipes and stuff so it's easier to copy. And then it factor now typing the name of the new level. What was the first level Based on the code book that's in our help. Just check again. Zero as male. Yeah, type in male and it has to be quoted because it's a character, male equals zero. You might as well now new line, female equals one because you could record them one by one, but you could add as many as you wanted to the same. Try and run that error. It's quite an unfriendly error code, but the important bit is must be a named string. Now that's confusing. String is what other programming languages call characters. Words and sentences. Characters. But all other programming languages call them, sometimes call the string. Basically, it's saying that the and need to be quoted because it's a string, which is a character if you just because the factor function added invisible quotes around them. So that's what factor record needs to see as well. That worked. If you now look at the environment, there we go. And scroll down to the new pre op gender, a factor with two levels, male and female. Another thing that I always do when I anything is now on a new lined into account. Please count pre op gender and pre op gender two. This is a way to check that everything went as you expected. This is quite a simple example. We were only recoded two levels, it's likely that we got it right. However, if you were doing multiple levels and you were copy pasting code, you might get the two levels mixed up. Now we can see that a zero show up as males in the new column and all ones show up at females. If you had made mistakes, I said quite unlikely, which is two levels. But if you had multiple levels, you would have to check that they still match up. What I also normally do, once they do match up, once I'm convinced my code is correct, I will now overwrite it. Instead of creating a duplicate variable called pre op gender two. If you just remove the two, now write like that, you'll get overwritten. Once the code is executed, the changes should appear in the environment. Pre op gender is now a factor zeros and ones are no more. And now, would you like, do you should we overwrite our dataset as well or are we going to keep creating this new dataset? We'll keep creating the new dataset. It's always a good idea to have a raw copy. The only reason for not having it is the dataset is, I mean, like millions of rows and thousands of columns. Then your computer might struggle with the memory. However, with anything that's tens of thousands of rows, I always just have a raw copy and a working copy. Then you could quickly go back and check what's happened here. Can you now copy the four lines that are starting from the inside the mutate? We basically want to recode two more variables quickly using the same code. Mm hm. But yeah, one at the time, that's great. I think we have an extra. What we now want to recode is ASA check the data dictionary book in the tab to see what you're doing. I think it's lagging quite a bit. Again, I don't know why. Yeah, yeah, you'll have to basically copy based from the data dictionary while Sarah does that, while Sarah copy paste and records the ASA grade and then the treatment variable as well, which is a couple down. I will tell you that I wanted to do a very quick poll on the use of redcap - can I do a poll? I've tired. Question yep good. Okay, so can everyone. Oh, did I make the poll live? I did launch. Sorry. There's a poll now, so I want to see whether people have used Redcap. Redcap stands for Research Electronic Data Capture, and it's a database software that's used to collect data. The reason I mentioned Red Cap is that if you use Redcap, then Red Cap will automatically generate the R code that generates factors you don't have to what Si is doing right now, copy pasting from a code book because it's something that was published 20 years ago and we don't have access to the original database. But normally if you use Redcap or other database software, you should be definitely from Redcap, able to just get this code automatically instead of doing it manually and copy basing from a data dictionary, which is quite pone and laborious. Yeah, most people have used, some haven't. You wouldn't always do this. Sometimes I'll also show you this, but sometimes data already comes in levels. It already says male and female, but they are characters and not factors. And I'll show you how and why you might want to change this as well. Oh, yeah, I'll keep right. Sarah is actively recoding the three variables. Just ASA and treatment. Yeah, exactly. Just just three. And then I'll show you a couple of further functions that can be applied on factors. Again, I would always save it into a number two first and then run the count to make sure they match up. No, that's fine. The simple examples, in the interest of time, will continue. But it's really if you have more than two levels, even if you have two levels, it's important to be, if you get the male and female, you get zeros and ones wrong. It can happen. So you need to check and double check. You need to be able to understand the data as well. Was it two years? No, no, it wasn't. It was four years ago that that an RCT published in the New England Journal of Medicine. I had to be retracted because they mixed up the zeros and ones in data analysis, exactly like what was doing right there. If she had put 1.0 and the wrong way, they mixed up the treatment treatment, the treatment groups. It turned out that they published this paper that said this treatment is beneficial but it was actually harmful. The opposite results, they published a obviously as you're supposed to in the incident report and how they will avoid issues like this in the future. Yep. Okay. Now we have these variables, can we please run a quick final fit on it? So let's see what the Leicage gargle is good for you. You leave the count one in, comment it out if people craft that script now it's not going to work because she's changed the agenda to no longer exists the lines 25.26 Just comment them out so they don't error. Yeah, but leave them. Yeah, there is an example. Let's run a quick in to check whether we think Licorice gargle is a useful tool to tackle post operative sore throat. We have, I'll tell you what the outcome variable is, but for now, a pipe licodato into final fit function quickly. If you look at the Help tab, the final variable. Scroll in the Help tab until you get to the last variable listed. That's the outcome. They have lots of different outcome variables. We'll take the one that's listed as the last one. Pain on the last one is because they have throat pain like an hour after surgery, half a day after surgery. That one is post operative day one, the next morning. Let's look at whether lirio reduces your sore throat next morning. Run that, Put that interdependent and an explanatory variable. Just treatment treat. Yeah. And run that. Yeah, the console much wider now and then you'll have to run it again. So they will hopefully put it on a make it wider again. We try again. Fifth times the charm. Yeah. I can't get walked are bile in the same line. Okay. But that's better already so that's fine. We can see that for the pain scale, I think it goes from something like zero to nine. The average, the mean pain for post operative pain for people who had the placebo or the sugar cargo was 0.6 It's quite a low pain, whereas it was lower for those who had the lege cargo. You can see that it's run a linear regression model, which in this case is not necessary. A test is the same result, but it does give you the reduction in pain, which is 0.3 Points. Now you might want to, because it's an RCT, you don't need to adjust for other variables. You might look at interactions and stuff, but we're not doing that. I will now show you that the coefficients, you can see that -0.3 is liqorage compared with sugar. If however syrup please read in the new CSV file, read underscoresV. Is this a It's a slightly different CSV file, and I'll show you why it's different. You call it odata, underscore CSV as well. I'll show you what the difference between reading it directly from a CSV. Just the final name is A. If you read that in and open it up from the environment. Yeah, click on the CSV file to the CSV. I think you're still looking. Click on it. You can see that in this file. I've already done the recording that you did. It's already female S treatment like that. You're like, why this is great. I'll get whoever is giving me the database extract just to replace all zeros and ones with these labels on the database. Yes, absolutely. That is the better way to do it because you're far less likely to then mix them. It's more likely you'll make a mistake between coding 11.2 and get the treatment wrong, or the effect wrong, if it comes as a literal word, liquor sugar, it's good. However, if you know copy paste the final fit code, please and run it into run it through the final fit model. These are characters, not factors. Could you maybe show in the environment as well? Because if you view that table, you can't tell the difference between a factor and a character. They look identical in the environment. But if you look at in the, in the environment, you can see that gender and ASA are called characters. Whereas where sera recoded them using the factor functions, they are factors in the, If you scroll may be up in the environment. Can we see? We wouldn't be able to see both of them anyway. Yeah, fight that into the exact same final code and run that. Yeah, those are factors. That's great. What does final fit tell us now? Final here, 0.693 Yeah. So you can see that once we read it in, froms filed, including the labels instead of 0.1 if you run a statistical model on it. If it's not a factor, it's a character. It's not a factor. If it's a character, the reference level is chosen alphabetically. Now you can see that the licage reference level and sugar is the comparison or the treatment, or harm or whatever, it's the same result. You would get the same statistical significance, you would get the same value, or you do get the same value, except that it's telling you that sugar increases throat pain compared with licorice That's the main reason forever messing around with factors and changing their orders to get your variabus in the right reference level. Because the only way to get the reference level right is to make it into a factor. The next function we're going to show is factor level. Whether you yourself coded factors and then wanted to change their order or whether you read them in from a CSV file and they were characters and they were alphabetical. Please pipe cota into a mutate and then Use the factory level function on the treatment table to make sugar reference level to the first level. Yeah. Sorry, which variable we're doing. Sorry, I said licodata. Pipe licodata Underscore CSV into. Okay. Yeah, and use the factor level function on the treatment variable because we need sugar to be the reference level. It doesn't make sense to say sugar is harmful compared with Licorice Every person in the world had a licorice gargle every single day. And that would be the standard. But I like licorice though, wouldn't I wouldn't mind that. I wouldn't love it. Yeah, it's divided. Divides crowds. Yeah, the factorial will work. You list the variables you want to bring to the front. If she only lists sugar five G, that's fine. That gets brought to the front. The reason I think Sarah's used the combined function, that quite often you want to do multiple. But you can admit it. You can just use a single one run that. If that works, I think it will. I don't see any errors. Oh no, I do see an error. Does anyone want to say why that code won't work? Type it into the box box. The error is completely uninformative. Come on. What fundamental thing Sarah missed out? She's trying to modify a column. She's trying to modify the treatment column within the licodataCSV tile. Whenever we're modifying a column or adding a new column mutate, you can't do anything without the mutate. You can see artists get so confused the error message isn't even coherent. Yeah. So Yeah, the fact it goes inside the mutate. Right. And probably an extra bracket needed. Yeah. Yeah. The ops are tricky in the console. Yeah, So you can see that. Yeah, exactly. Treatment now says factor instead of character save that, you can save it into data. Yeah, that's fine. I was like two maybe just because we had the old one as well. So you wouldn't normally read in the same data set from two different sources in a script, but this is just yeah to run that. Now if you copy the final fit lines again and put that through final fit, let's convince ourselves that factory level was a useful function. That helped us chi where we need to get the right factor, the right reference level Success Now you can see that sugar has moved to the front and factory level one. I use a lot if you had multiple, more than two levels and you wanted to move two to the front, three to the front, completely reorder it. You can put multiple arguments in sugar, next one, the next one, but at the moment, we only needed one. Can you just type in a comment? I'll mention similar functions that are also quite useful but we won't have time to show. Sorry, just to say, I think one that I use quite a lot in factor re level is sending one level to be the end level. Oh, how do you do that? You just say we need to double check but I think it's a, is it after infinity or something? Yeah. Yeah, that's true. Quite often want to send eraser your question in a second. Quite often you want to send the other level to the end or something like that. If you look at factory level help tab like eros after. I think if you do after equals infinity, will that put it into the end? It's like that. Yeah, try that. So it's not that useful because this is just two labels. But if you had no combining, put that bracket back that you deleted after sugar five. There has to be a bracket. Yes. All right. You probably have one extra then. Okay, We get with brackets, right? Oh yeah. After equals infinity moves it to the end. The other functions that I use a factor in order. Which order is a factor in frequency? So for example, if you, yeah, you have men and female and you want the reference level to be the most popular group. Instead of an alphabetical or whatever the data fraction in order will the factor levels in popularity. Because final fate or plot will not automatically plot things in popularity. But that's something I quite often do, especially when I plot not so much when I run registered models. And the other one I use a factor which is when you order variable based on the value of other variables. For example, in the same example, male and female. If you also, if you want to the group that is on average taller for some reason, if you wanted the tallest group to be the reference level, you could do factory order gender height. The gender will be ordered based on height. Therefore, men would probably be become the reference level. And women slightly, on average, shorter. You could also say whether you want it to be an average or a median factor order. That's quite an arbitrary example in your dataset. It happens quite often that I use factor reorder to re order one factor based on values of another column, sometimes factor. Which is the reason I would do that. For some reason reading patient actual names or numbers or something like that, the factor on will automatically generate unique but anonymous labels for them. Then you can remove the identifier or save it in a lookup table or something like that. We will now show factor collapse and zero had a question, when to use factor collapse instead of factor recode. And you are correct. You can use factor recode to achieve the same thing that factor collapse does. The exact same thing. The reason I use factor collapse and those who haven't used it will show zero will show on. Please collapse the ASA grad into two levels. Disease at the moment it's three levels, but could you collapse it into two while serotypes there in and then she show you what she's done. The only there's two reasons to use factor collapse. Mainly it's clear to yourself and anyone else reading your script that what you're doing, you could record multiple different labels, levels into the same level. And that achieves the exact same purpose as collapse, but that's not obvious. Whereas if you're typing factor collapse, someone could see a there collapsing levels. I know it's just the clarity as I said, ASA grade as it comes in, this data set has three options. I guess the inclusion criteria are understandably excluded. People of ASA 4 and 5 Yeah. Some disease. Exactly. So was to collapse the two levels that had some disease. Actually, I think I've just copied the wrong I think. Yeah, I called it. You can just copy from your own. Copied from your own code. Oh yeah. That's even more sensible. Oh yeah, from that. Maybe some disease. Call it systemic disease. Yeah. And the other. That doesn't matter because they all get collapsed into the same one. Silly, you can run that. I know this will error, but it would be good to show the error that comes from this argument is with no defaults. The factor is missing inside the collapse. The first argument to collapse is the actual factor we collapsing. Let's run that. Oh, yeah, yeah. And save it into a new. You can overwrite it. Test, yeah. Okay. And now pipe testing to count the preps and preps too, to make sure that the levels work. Yeah, there we go. This is how factor collapse works. So you can see that everything that used to be called minor severe systemic disease is now called systemic disease. We still have our healthy, the new argument that I promised to show everyone that I only discovered as I was putting this together inside fact collapse an argument. Who here has type into the chat box if you have used other level within factor collapse so that sera will show you how that works. If you pipe licodtor into a mutate, please. Yeah, but we can't use it with the ASA example because it needs at least more than three levels. Basically other level is something you would use. Pipe it into mutate. Let's make the post operative 01:00 A.M. throat pain, copy that. The outcome. Let's make it into a factor just for this example. Not unreal that you would do that anyway, that in exactly. To put that in there, we would make that into a factor. Call it to Just for now. Yep. I'll learn my lesson. Yeah, pipe it into a factor. Exactly. Yeah, brackets just to save time, maybe pipe that into to remove that. Just for Just quickly because I'll get you anyway. Keep going. Put factor collapse in the face. That's factor collapse. We're running out of time just deleting it. Bad. That's fine. To put factor collapse. No pain, no pain equals zero. Yeah. Now, at the end of the leave it like that. Just leave it like that. Don't do anymore, just single thing. Instead, at the end of the other side of the mutate, just pipe it directly into account. Just the same time to count the two, that pain. What happened? Like, what are we working on? Oh, yeah, sorry. They didn't tell you what to count. Oh, that's quite cool. Actually, if you just run an empty count to change to the number of rows. Oh, I see. The delay is really bad because you said the same thing like, okay, so if zero does that, it's 0-6 Can you put the other, the original pane as well? Because we want to see what the two variables now look like. Here, there we go. Okay, so if she only puts a single level into factor collapse, it looks as if she used factory code. That's related to serious question. Sometimes factory code and collapse can do the same thing. However, if she now adds in another argument not quoted by the function argument called other underscore level inside factor collapse. Yeah, within the factor collapse, typing other underscore level equals some pain. other_level. Yeah, exactly. And now quoted some pain. A. Interesting. That's new. That's cool. Yeah. We run it to see if it works Well, look at that. How efficient is that? Instead of now having 06, she has two factor levels. There's no pain or some pain for anything. If she had defined, say no pain, a little pain, one, and then other levels, basically everything that you don't specify in factor collapse gets put into the other level which she's called pain this. Okay. That's all I wanted to show you. Let's take questions now. Does anyone have questions about these factors and factor handling? Obviously, you're also welcome to ask any questions about your own analysis, but we probably will stop the recording before we get to non related questions to seras showing you that he can add in two levels. Do you have a question about this is nodding. Help out as well and I forget it is very frustrating. I work in the safe haven at the moment and you can't copy and paste code and things in and out. Yeah, anyway, I have thought about that issue. Yeah, I'm happy to troubleshoot with you in getting the healthy book. Someone's definitely got the healthy book into the safe favour. I've done this a few ago. Yeah. Just like offline copy of it. Yeah. A Let's discuss that. That would be I will try and find that e mail. I'm sure I helped someone with this. Yeah, that'd be great. If there's no question about this. I'll end the recording and we'll see if we can chat about other things.